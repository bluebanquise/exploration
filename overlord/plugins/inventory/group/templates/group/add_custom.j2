{% extends "main.j2" %}

{% block content %}
<h1 class="title">Create Custom group</h1>

<div class="box" style="max-width: 800px;">

  <div class="field">
    <label class="label">Group name</label>
    <input id="group_name" class="input" type="text" value="{{ request.args.get('name') }}">
  </div>

  <div class="field">
    <label class="label">Custom variables (YAML)</label>
    <textarea id="custom_vars" class="textarea" rows="10"></textarea>
  </div>

  <button class="button is-primary" onclick="createGroup()">Create group</button>
</div>

<script>
async function createGroup() {
    const name = document.getElementById("group_name").value.trim();

    // Forbidden prefixes
    const forbidden = ["fn_", "os_", "hw_", "rack_"];

    if (forbidden.some(p => name.startsWith(p))) {
        showNotification("is-danger", "Custom group names cannot start with fn_, os_, hw_, or rack_");
        return;
    }

    await apiRequest("POST", "/api/v1/inventory/group", {
        [name]: {
            group_type: "custom",
            vars: {
                custom: {
                    custom_vars: document.getElementById("custom_vars").value,
                }
            }
        }
    });

    window.location.href = "/inventory/group/list";
}
</script>
{% endblock %}
